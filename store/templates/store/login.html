{% extends 'store/base.html' %}
{% block content %}

<style>
  /* Use the same ambient image as your Home page */
  .kc-scene{ --ambient-url: url('/media/banners/snacks-ambient.jpg'); }

  /* ===== Login page polish ===== */
  .auth-wrap{ max-width: 980px; margin-inline:auto; }
  .auth-card{
    position:relative; border-radius:18px; border:1px solid #efdfcd;
    background:linear-gradient(180deg, rgba(255,255,255,.72), rgba(255,255,255,.94));
    box-shadow:0 14px 32px rgba(43,23,14,.10); backdrop-filter: blur(6px);
    overflow:hidden; animation:rise .45s ease both;
  }
  .auth-card::after{
    content:""; position:absolute; inset:-1px; pointer-events:none; border-radius:inherit;
    background:
      radial-gradient(240px 200px at 12% 8%, rgba(255,170,110,.16), transparent 60%),
      radial-gradient(280px 240px at 88% 90%, rgba(255,140,160,.12), transparent 60%);
  }
  .auth-title{
    display:flex; justify-content:center; align-items:center; gap:.6rem;
    font-weight:900; letter-spacing:.2px; color:#2b170e; margin:0 0 .25rem;
  }
  .auth-title .grad{
    background:linear-gradient(90deg,#ff7a00,#ffc155);
    -webkit-background-clip:text; background-clip:text; color:transparent;
  }
  .auth-sub{ text-align:center; color:#6b7280; margin-bottom:12px }

  /* Make Django form fields look great without rewriting them */
  .auth-form p{ margin-bottom:14px }
  .auth-form label{ font-weight:700; color:#2b170e; margin-bottom:6px; display:block }
  .auth-form input[type="text"],
  .auth-form input[type="email"],
  .auth-form input[type="password"]{
    width:100%; border-radius:12px; border:1px solid #efdfcd; padding:.68rem .9rem .68rem 2.4rem;
    background:#fff; box-shadow: inset 0 1px 0 rgba(0,0,0,.02);
  }
  .auth-form input:focus{
    outline:0; border-color:#f0c88e; box-shadow:0 0 0 .2rem rgba(255,170,110,.18), inset 0 1px 0 rgba(0,0,0,.02);
  }
  .field-wrap{ position:relative }
  .field-icon{
    position:absolute; left:.65rem; top:50%; transform:translateY(-50%);
    color:#9a7e6a; font-size:1.05rem; pointer-events:none;
  }
  .pw-toggle{
    position:absolute; right:.45rem; top:50%; transform:translateY(-50%);
    border:none; background:transparent; color:#6b7280; padding:.25rem .5rem; border-radius:10px; cursor:pointer;
  }
  .pw-toggle:hover{ color:#111 }

  /* Snacky primary button */
  .btn-snack{
    --bg:linear-gradient(135deg,#ff7a00,#ffc155);
    background:var(--bg)!important; color:#3a1d0f!important; border:none!important; border-radius:999px!important;
    box-shadow:0 12px 28px rgba(255,138,0,.25)!important; font-weight:900!important; position:relative; overflow:hidden;
    transition:transform .18s ease, filter .18s ease, box-shadow .18s ease;
  }
  .btn-snack:hover{ transform:translateY(-1px); filter:saturate(1.06); box-shadow:0 16px 34px rgba(255,138,0,.34)!important }
  .btn-snack::before{
    content:""; position:absolute; inset:0;
    background:linear-gradient(110deg,transparent 30%,rgba(255,255,255,.45) 50%,transparent 70%);
    transform:translateX(-130%); transition:transform .65s ease;
  }
  .btn-snack:hover::before{ transform:translateX(130%) }
  .btn-snack:active::after{
    content:""; position:absolute; left:50%; top:50%; width:14px; height:14px; transform:translate(-50%,-50%);
    background:
      radial-gradient(#fff 2px, transparent 3px) 0 0/8px 8px,
      radial-gradient(#ff7a00 2px, transparent 3px) 4px 4px/8px 8px,
      radial-gradient(#ff4d6d 2px, transparent 3px) 0 4px/8px 8px,
      radial-gradient(#ffc155 2px, transparent 3px) 4px 0/8px 8px;
    animation:burst .6s ease forwards;
  }

  /* Processing overlay */
  .processing{
    display:none; position:fixed; inset:0; z-index:50; background:rgba(255,255,255,.85);
    align-items:center; justify-content:center; flex-direction:column;
  }
  .processing .spinner{
    width:42px; height:42px; border:3px solid rgba(0,0,0,.15); border-top-color:#2b170e; border-radius:50%;
    animation:spin .8s linear infinite;
  }
  .processing .msg{ margin-top:10px; color:#2b170e; font-weight:800 }

  /* Small animations */
  @keyframes rise{ from{opacity:0; transform:translateY(8px)} to{opacity:1; transform:none} }
  @keyframes burst{ to{opacity:0; transform:translate(-50%,-70%) scale(2)} }
  @keyframes spin{ to{ transform:rotate(360deg) } }
</style>

<div class="auth-wrap">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <div class="auth-card p-4 p-md-5">
        <h2 class="auth-title"><span class="grad">Log In</span></h2>
        <div class="auth-sub">Welcome back to Korichuko — fresh snacks, fast delivery.</div>

        <form method="post" class="auth-form" id="loginForm">
          {% csrf_token %}
          {{ form.as_p }}
          <button type="submit" class="btn btn-success btn-snack w-100 mt-2">
            <i class="bi bi-box-arrow-in-right me-1"></i> Log In
          </button>
        </form>

        <p class="mt-3 text-center">
          Don't have an account?
          <a href="{% url 'store:signup' %}" class="text-decoration-none fw-bold" style="color:#3a1d0f">Sign up here</a>.
        </p>
      </div>
    </div>
  </div>
</div>

<!-- Processing overlay -->
<div id="processingOverlay" class="processing" role="status" aria-live="polite">
  <div class="spinner" aria-hidden="true"></div>
  <div class="msg">Processing your login…</div>
</div>

<script>
(function(){
  const form = document.getElementById('loginForm');
  const overlay = document.getElementById('processingOverlay');

  // 1) Enhance Django-rendered fields: wrap inputs, add icons, add password toggle
  const iconFor = (name, type) => {
    const n = (name||'').toLowerCase();
    if(type==='password') return 'bi-lock';
    if(n.includes('user')) return 'bi-person';
    if(n.includes('email')) return 'bi-envelope';
    return 'bi-dot';
  };

  // Turn each <p> (from {{ form.as_p }}) into a styled field row
  form.querySelectorAll('p').forEach(p=>{
    const input = p.querySelector('input');
    if(!input) return;
    // Add baseline class
    input.classList.add('form-control');
    // Wrap for icons & toggle
    const wrap = document.createElement('div');
    wrap.className = 'field-wrap';
    input.parentNode.insertBefore(wrap, input);
    wrap.appendChild(input);

    // Icon
    const i = document.createElement('i');
    i.className = 'bi '+iconFor(input.name, input.type)+' field-icon';
    wrap.appendChild(i);

    // Password toggle
    if(input.type === 'password'){
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'pw-toggle';
      btn.innerHTML = '<i class="bi bi-eye"></i>';
      btn.addEventListener('click', ()=>{
        const isPw = input.type === 'password';
        input.type = isPw ? 'text' : 'password';
        btn.innerHTML = isPw ? '<i class="bi bi-eye-slash"></i>' : '<i class="bi bi-eye"></i>';
        input.focus();
      });
      wrap.appendChild(btn);
    }
  });

  // 2) Show a smooth overlay while submitting (no preventDefault — server handles auth)
  form.addEventListener('submit', ()=>{
    overlay.style.display = 'flex';
  });
})();
</script>

{% endblock %}
